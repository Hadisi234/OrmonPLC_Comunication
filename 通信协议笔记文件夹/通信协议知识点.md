## **1.1 EtherCAT概述**

EtherCAT简介（EtherNet Control Automation Technology），2003年由倍福发明，2014年成为我国的国标。

- EtherCAT（以太网控制自动化技术）是以以太网为基础的开放架构的现场总线系统。总线就是用来通信的
- EtherCAT是基于以太网但比以太网更高速和高效的一种高性能工业网络系统。（现由ETG掌握及推广）

EtherCAT网络的特点

- 开放、通用
- 高速、稳定
- 拓扑灵活
- 通信数据输入/输出各5736个字节
- 最多192个从站（NJ系列的欧姆龙PLC可以带192个）
- 两个设备之间距离最长100米

与其它厂商EtherCAT从站设备通信

- ESI文件包含EtherCAT从站的特征信息（.Xml文件格式），主要提供设备信息



**为什么EtherCat不需要去计算Mac地址？**
EtherCAT 是一种实时以太网技术，它通常不需要计算 MAC 地址，主要有以下几个原因：

1. EtherCAT 基于以太网技术，但它具有自己独特的通信机制和帧结构。在 EtherCAT 网络中，从站设备通常不是通过传统的以太网 MAC 地址来进行识别和通信的。
2. EtherCAT 采用了主从式的通信架构，**主站负责控制整个网络的通信和数据传输，从站设备按照主站发送的帧中的特定位置和指令进行响应**。
3. EtherCAT 的通信帧在经过每个从站时，从站会根据帧中的特定信息进行处理和数据交换，而不是依赖 MAC 地址来确定通信的目标。
4. 这种特殊的通信方式和帧结构设计使得 EtherCAT 能够实现高效的实时通信，减少了传统以太网中基于 MAC 地址的寻址和路由带来的延迟和复杂性。



**OSI 模型分为七层**：

1. 物理层：负责在物理介质上传输比特流。
2. 数据链路层：将比特组合成帧，并进行错误检测和纠正。
3. 网络层：负责数据包的路由和转发。
4. 传输层：提供端到端的可靠或不可靠的数据传输服务。
5. 会话层：建立、管理和终止会话。
6. 表示层：处理数据的表示方式，如加密、压缩等。
7. 应用层：为应用程序提供网络服务。

**TCP/IP 模型通常分为四层**：

1. 网络接口层：对应 OSI 模型的物理层和数据链路层。
2. 网络层：对应 OSI 模型的网络层，主要协议是 IP。
3. 传输层：对应 OSI 模型的传输层，主要协议是 TCP 和 UDP。
4. 应用层：对应 OSI 模型的会话层、表示层和应用层。

**EtherCat需要IP吗**？

EtherCAT 本身不需要 IP 地址来进行通信。EtherCAT 是一种基于以太网的工业以太网技术，它使用以太网帧进行数据传输，但不像传统的以太网通信那样依赖于 IP 地址进行网络寻址和路由。
然而，在一些更复杂的网络架构中，可能会将 EtherCAT 网络与基于 IP 的网络集成，此时可能会为 EtherCAT 设备分配 IP 地址，但这并非 EtherCAT 通信的必需条件。

在 EtherCAT 与 IP 集成的情况下，虽然数据是封装在 IP 数据包中进行传输，但 EtherCAT 本身的通信机制通常并不依赖于传统以太网中的 MAC 地址来进行设备识别和数据交换。
然而，**从整个网络通信的角度来看，当在以太网环境中传输 IP 数据包时，底层的以太网通信确实需要 MAC 地址来确定数据帧的目标。**
但这主要是由以太网的物理层和数据链路层处理，对于 EtherCAT 的应用层通信逻辑来说，其重点仍然是 EtherCAT 特定的帧结构和控制机制。
所以，从严格意义上讲，这种集成情况下，在以太网传输层面是需要 MAC 地址的，但对于 EtherCAT 的核心通信机制，MAC 地址并非其关键的识别和控制要素。



## 1.2 EtherNet/IP概述

### 1.2.1 EtherNet/IP概述

1. EtherNet/IP是控制器与控制器之间的网络，同样可以作为一种控制现场的网络来使用。另外由于使用开发的以太网技术，可以实现多厂商联合的工业网络。（现由ODVA掌握及推广，也是基于以太网的改进）

2. EtherNet/IP是使用了以太网的标准协议TCP/IP的符合世界规格工业用以太网。**应用层封装了CIP（通用工业协议），具有与ODVA的CIP网络间无缝通信的特长。简称EIP。**在PLC与上位机通信、组态时和PLC间数据共享时可以使用。

   - 注：1、CIP是通用工业协议，DeviceNet、ControlNet、CompoNet网络也都支持CIP

     ​	2、ODVA是由全世界自动化领导企业组成的一个国际性组织。

![image-20240919113605014](./%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE%E7%9F%A5%E8%AF%86%E7%82%B9.assets/image-20240919113605014.png)

### 1.2.2 EIP网络的作用

- 控制器间互相通信
- 通过标签数据链接（Tag data link）实现灵活的通信
- 与触摸屏或上位机组态软件通信
- 与Sysmac Studio 通信
- 与第三方设备通信

## 1.3 标签数据链接（Tag Data Link）概述

### 1.3.1 CIP通信的分类

1. 标签数据链接（每一个数据周期都会进行输入输出，进行数据更新。自动）
   - 周期通信
   - UDP协议（端口2222）
   - 32个链接（NJ欧姆龙PLC支持）
   - 常时自动更新
2. 报文通信（报文触发，需要的时候进行读取）
   - Class3或UCMM通信
   - TCP协议（端口44818）
   - 32个通信（NJ欧姆龙PLC支持）
   - CIP专用指令

### 1.3.2 标签数据链接概念

​	标签数据链接是指通过EIP在设备之间进行周期性的数据交换的一种功能；标签数据链接的设定是通过Network Configurator for EtherNet/IP这个软件来实现的。通信是以标签为基础的，一个标签组最多8个标签，一个链接就是一个标签组，一个链接最多600个字节，链接数据最多9600个字。不够可以增加EIP模块。

#### 1.3.2.1 连接方式

1. 组播方式（Multi-cast connection）：多点传送
   - 输出类标签组面向整个网络广播
   - 输出类标签组传送给多个节点时，用这种方式只需一次打包发送数据；
   - 如有的节点不需要接受数据包，可使用带组播过滤功能的以太网交换机
2. 点对点方式（Unicast connection）：单点传送
   - 输出类标签组独立地发给各个节点；
   - 一个输出类标签组传递给多个节点时，用这种方式需多次打包发送数据

## 1.4 CIP报文通信

### 1.4.1 报文通信概念

- 通过CIP命令完成EtherNet/IP网络设备间变量数据读写
- CIP命令能在EIP网络运行过程中的任何时刻被请求发送到其他设备

![image-20240919132533945](./%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE%E7%9F%A5%E8%AF%86%E7%82%B9.assets/image-20240919132533945.png)

1.4.1.1 报文通信的变量

- 设置**网络公开**属性的**全局变量**
- 具有**网络公开**属性的**系统变量**

1.4.1.2 报文通信的方式

1. UCMM方式（UnConnected Message Manager）
   - UCMM为非连接报文管理器
   - 使用UCMM方式时请求设备和应答设备之间是不组成连接
   - 效率高，但可靠性不高
2. Class3为连接报文通信
   - 
